<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog Detail</title>
    <link rel="stylesheet" href="path/to/bootstrap.css" />
    <link rel="stylesheet" href="path/to/font-awesome.css" />
  </head>

  <body>
    <!-- Blog Details Container -->
    <div id="blog-detail" class="container py-5">
      <div id="blog-content">
        <!-- The blog content will be rendered here -->
      </div>
    </div>

    <script>
      // Function to fetch single blog based on slug
      function fetchBlogDetail(slug) {
        fetch(
          `https://life-insurance-website-template-uthayas-projects-5d5b23e4.vercel.app/api/blogs/${slug}`
        )
          .then((response) => response.json())
          .then((result) => {
            console.log("Fetched single blog data:", result);

            if (!result || !result.items || result.items.length === 0) {
              console.error("No blog found with the provided slug.");
              return;
            }

            const blogItem = transformBlogData(
              result.items[0],
              result.includes
            );
            renderBlogDetail(blogItem);
          })
          .catch((err) => console.error("Error fetching blog details:", err));
      }

      // Get slug from URL query string
      function getBlogSlugFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        const slug = urlParams.get("slug");
        console.log(slug, "slug from url");
        return slug;
      }

      // Render single blog details
      function renderBlogDetail(blogItem) {
        const blogDetailContainer = document.getElementById("blog-content");

        const blogTitle = blogItem.blogTitle;
        const blogDescription = blogItem.blogDescription;
        const blogAuthor = blogItem.blogAuthor || "Admin";
        const blogDate = formatDate(blogItem.blogDate);
        const blogThumbnailImage = blogItem.blogThumbnailImage;

        blogDetailContainer.innerHTML = `
        <h1 class="display-4 mb-4">${blogTitle}</h1>
        <div class="small text-muted mb-4">
          <span class="fa fa-user text-primary"></span> ${blogAuthor} | 
          <span class="fa fa-calendar text-primary"></span> ${blogDate}
        </div>
        ${
          blogThumbnailImage
            ? `<img src="${blogThumbnailImage}" class="img-fluid rounded mb-4" alt="${blogTitle}" />`
            : ""
        }
        <div class="blog-description">${blogDescription}</div>
      `;
      }

      // Convert rich text to HTML
      function convertRichTextToHtml(richText) {
        if (!richText || !richText.content) return ""; // Return empty if invalid or empty content

        let htmlContent = "";

        richText.content.forEach((node) => {
          if (node.nodeType === "paragraph") {
            let paragraph = "";
            node.content.forEach((textNode) => {
              if (textNode.nodeType === "text") {
                const text = textNode.marks.length
                  ? `<strong>${textNode.value}</strong>`
                  : textNode.value;
                paragraph += text;
              }
            });
            htmlContent += `<p>${paragraph}</p>`;
          }
        });

        return htmlContent;
      }

      // Format date
      function formatDate(dateString) {
        if (!dateString) return "";
        const options = { day: "numeric", month: "short", year: "numeric" };
        return new Date(dateString).toLocaleDateString("en-US", options);
      }

      // Call the function when the page is loaded
      document.addEventListener("DOMContentLoaded", function () {
        const slug = getBlogSlugFromUrl();
        if (slug) {
          console.log(slug, "slug after dom load");
          fetchBlogDetail(slug);
        } else {
          console.error("No slug found in URL.");
        }
      });
    </script>
  </body>
</html>
